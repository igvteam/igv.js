<!DOCTYPE html>
<html lang="en">

<head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
    <meta charset="utf-8">
    <link href="https://igv.org/web/img/favicon.ico" rel="shortcut icon">
    <title>igv.js</title>


</head>

<body>

<h3>Example illustrating options for coloring VCF variants</h3>
<h4>
    <ol>
        <li>INFO tag with borderColor</li>
        <li>INFO tag with customDraw</li>
    </ol>
</h4>

<div id="igvDiv" style="padding-top: 50px;padding-bottom: 20px; height: auto"></div>


<script type="module">

    import igv from "../../js"

    function drawTrianglerect(context, x, y, w, h) {
        let n = Math.floor(w / h)
        let p = (w % h) / 2

        context.clearRect(x, y, w, h)
        context.fillRect(x, y, w, h / 2)

        for (var i = 0; i < n; i++) {
            drawTriangle(context, p + x + (i) * h, y, h, h)
        }

    }

    function drawTriangle(context, x, y, w, h) {
        // context.clearRect(x, y, w, h)

        context.beginPath()
        context.moveTo(x, y)
        context.lineTo(x + w / 2, y + h)
        context.lineTo(x + w, y)
        context.closePath()
        context.fill()
    }

    function drawCirclerect(context, x, y, w, h) {
        let n = Math.floor(w / h)
        let p = (w % h) / 2

        context.clearRect(x, y, w, h)
        context.fillRect(x, y, w, h / 2)

        for (var i = 0; i < n; i++) {
            drawCircle(context, p + x + (i) * h, y, h, h)
        }

    }


    function drawCircle(context, x, y, w, h) {
        // context.clearRect(x, y, w, h)

        context.beginPath()
        context.arc(x + w / 2, y + h / 2, h / 2, 0, 2 * Math.PI)
        context.fill()
    }

    function drawRoundrect(context, x, y, w, h) {
        let radius = 5
        context.clearRect(x, y, w, h)
        context.beginPath()
        context.moveTo(x + radius, y)
        context.lineTo(x + w - radius, y)
        context.quadraticCurveTo(x + w, y, x + w, y + radius)
        context.lineTo(x + w, y + h - radius)
        context.quadraticCurveTo(x + w, y + h, x + w - radius, y + h)
        context.lineTo(x + radius, y + h)
        context.quadraticCurveTo(x, y + h, x, y + h - radius)
        context.lineTo(x, y + radius)
        context.quadraticCurveTo(x, y, x + radius, y)
        context.closePath()
        // context.stroke()
        context.fill()
    }

    const options =
        {
            locus: "chr22",
            genome: "hg38",
            tracks: [
                {
                    url: "https://s3.amazonaws.com/igv.org.demo/nstd186.GRCh38.variant_call.vcf.gz",
                    indexURL: "https://s3.amazonaws.com/igv.org.demo/nstd186.GRCh38.variant_call.vcf.gz.tbi",
                    name: "Color borderColor",
                    colorBy: "SVTYPE",
                    visibilityWindow: -1,
                    borderColor: function (variant) {
                        // stroke outline in red for variants with AF below 1%
                        const mc = parseFloat(variant.info["AF"])
                        if (mc < 0.05) {
                            return "red"
                        } else if (mc > 0.2) { //stroke in green for variants with AF above 20%
                            return "green"
                        }
                    }
                },
                {
                    url: "https://s3.amazonaws.com/igv.org.demo/nstd186.GRCh38.variant_call.vcf.gz",
                    indexURL: "https://s3.amazonaws.com/igv.org.demo/nstd186.GRCh38.variant_call.vcf.gz.tbi",
                    name: "Color context hook",
                    colorBy: "SVTYPE",
                    visibilityWindow: -1,
                    customDraw: function (variant, context, x, y, w, h) {
                        const mc = parseFloat(variant.info["AF"])
                        if (mc < 0.05) {
                            drawCirclerect(context, x, y, w, h)
                        } else if (mc < 0.5) {
                            drawTrianglerect(context, x, y, w, h)
                        } else {
                            context.strokeStyle = 'green'
                            context.lineWidth = 1
                            context.strokeRect(x, y, w, h)
                        }
                    }
                }
            ]
        }

    const igvDiv = document.getElementById("igvDiv")

    igv.createBrowser(igvDiv, options)

        .then(function (browser) {

        })

</script>

</body>

</html>
