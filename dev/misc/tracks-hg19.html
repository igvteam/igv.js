<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <meta content="" name="description">
    <meta content="" name="author">
    <link href="https://igv.org/web/https://igv.org/web/img/favicon.ico" rel="shortcut icon">

    <title>hg19 test</title>

</head>

<body>

<p>


<h1>Test tracks</h1>

<p>
    <b>Look for console errors and compare with
        <a target="_blank" href="https://drive.google.com/file/d/1E7SkKtPHgDqnlXYm2DEWOGBsbSAIBnaD/view?usp=sharing">tracks-hg19.png</a>
    </b>
</p>
<p>
    <button id="bookmarkButton">Bookmark</button>
    <button id="sessionButton">Session JSON</button>
    <button id="svgButton">Save SVG</button>
</p>


<div id="igvDiv" style="padding-top: 10px;padding-bottom: 10px; border:1px solid lightgray"></div>

<script type="module">

    import igv from "../../js/index.js";

    const options =
        {
            genome: "hg19",
            locus: "chr1:155,138,124-155,153,715",
            tracks:
                [
                    {
                        name: "Phase 3 WGS variants",
                        url: "https://s3.amazonaws.com/1000genomes/release/20130502/ALL.wgs.phase3_shapeit2_mvncall_integrated_v5b.20130502.sites.vcf.gz",
                        indexURL: "https://s3.amazonaws.com/1000genomes/release/20130502/ALL.wgs.phase3_shapeit2_mvncall_integrated_v5b.20130502.sites.vcf.gz.tbi",
                    },
                    {
                        name: "ENCODE bigwig",
                        url: 'https://www.encodeproject.org/files/ENCFF206QIK/@@download/ENCFF206QIK.bigWig'
                    },
                    {
                        url: "https://www.encodeproject.org/files/ENCFF001GBH/@@download/ENCFF001GBH.bigBed",
                        color: "rgb(0, 150, 0)",
                        name: "Bigbed with color (green)",
                    },
                    {
                        url: 'http://hgdownload.cse.ucsc.edu/goldenPath/hg19/encodeDCC/wgEncodeBroadHistone/wgEncodeBroadHistoneGm12878H3k4me3StdSig.bigWig',
                        name: 'Group Autoscale 1 of 3',
                        color: 'rgb(200,0,0)',
                        autoscaleGroup: '1'
                    },
                    {
                        url: 'http://hgdownload.cse.ucsc.edu/goldenPath/hg19/encodeDCC/wgEncodeBroadHistone/wgEncodeBroadHistoneGm12878H3k27me3StdSig.bigWig',
                        name: 'Group Autoscale 2 of 3',
                        color: 'rgb(0,0,150)',
                        autoscaleGroup: '1'
                    },
                    {
                        url: 'http://hgdownload.cse.ucsc.edu/goldenPath/hg19/encodeDCC/wgEncodeBroadHistone/wgEncodeBroadHistoneGm12878H3k36me3StdSig.bigWig',
                        name: 'Group Autoscale 3 of 3',
                        color: 'rgb(0,150,0)',
                        autoscaleGroup: '1'
                    },
                    {
                        name: "Merged",
                        height: 50,
                        type: "merged",
                        tracks: [
                            {
                                "type": "wig",
                                "format": "bigwig",
                                "url": "https://www.encodeproject.org/files/ENCFF000ASJ/@@download/ENCFF000ASJ.bigWig",
                                "color": "red"
                            },
                            {
                                "type": "wig",
                                "format": "bigwig",
                                "url": "https://www.encodeproject.org/files/ENCFF351WPV/@@download/ENCFF351WPV.bigWig",
                                "color": "green"
                            }
                        ]
                    },
                    {
                        url: 'https://s3.amazonaws.com/igv.org.test/data/wgEncodeBroadHistoneGm12878H3k4me3StdSig.wig.tdf',
                        name: 'tdf file',
                        color: 'blue'
                    },
                    {
                        name: "CTCF - string url",
                        type: "wig",
                        format: "bigwig",
                        url: "https://www.encodeproject.org/files/ENCFF563PAW/@@download/ENCFF563PAW.bigWig"
                    },
                    {
                        name: "CTCF - function url ",
                        type: "wig",
                        format: "bigwig",
                        url: function () {
                            return "https://www.encodeproject.org/files/ENCFF563PAW/@@download/ENCFF563PAW.bigWig"
                        }
                    },
                    {
                        name: "CTCF - promise url",
                        type: "wig",
                        format: "bigwig",
                        url: Promise.resolve("https://www.encodeproject.org/files/ENCFF563PAW/@@download/ENCFF563PAW.bigWig")
                    },
                    {
                        name: "CTCF - function that returns promise ",
                        type: "wig",
                        format: "bigwig",
                        url: function () {
                            return Promise.resolve("https://www.encodeproject.org/files/ENCFF563PAW/@@download/ENCFF563PAW.bigWig")
                        }
                    },
                    {
                        name: "CTCF - function that returns thenable ",
                        type: "wig",
                        format: "bigwig",
                        url: function () {
                            return {
                                then: function (resolve, reject) {
                                    resolve("https://www.encodeproject.org/files/ENCFF563PAW/@@download/ENCFF563PAW.bigWig")
                                }
                            }
                        }
                    },
                    {
                        name: "Copy number -- embedded (json) features",
                        type: "seg",
                        displayMode: "EXPANDED",
                        log: true,
                        features: [
                            {
                                "chr": "chr1",
                                "start": 155141825,
                                "end": 155150000,
                                "value": 0.8239,
                                "sample": "Sample 1"
                            },
                            {
                                "chr": "chr1",
                                "start": 155149967,
                                "end": 155150988,
                                "value": -0.8391,
                                "sample": "Sample 2"
                            }
                        ]
                    }
                ]

        };

    var igvDiv = document.getElementById("igvDiv");

    igv.createBrowser(igvDiv, options)
        .then(function (browser) {

            console.log("Created IGV browser");

            document.getElementById("sessionButton").addEventListener("click", () => {
                try {
                    const json = browser.toJSON();
                    console.log(json);
                    const jsonString = JSON.stringify(json, null, '\t');
                    const data = URL.createObjectURL(new Blob([jsonString], {type: "application/octet-stream"}));
                    download("session.json", data);
                } catch (e) {
                    alert(e);
                }
            })

            document.getElementById("bookmarkButton").addEventListener("click",
                () => window.history.pushState({}, "IGV", browser.sessionURL()))

            document.getElementById("svgButton").addEventListener("click", () => {
                let svg = browser.toSVG();
                const path = 'tracks-hg19.svg';
                const data = URL.createObjectURL(new Blob([svg], {type: "application/octet-stream"}));
                download(path, data);
            })

        })

    function download  (filename, data) {

        const element = document.createElement('a');
        element.setAttribute('href', data);
        element.setAttribute('download', filename);
        element.style.display = 'none';
        document.body.appendChild(element);
        element.click();
        document.body.removeChild(element);
    }

</script>

</body>

</html>
